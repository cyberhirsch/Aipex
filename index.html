<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aipex - AI Model Rankings</title>
    <link rel="stylesheet" href="style.css">
    
    <!-- Updated Firebase SDK - using modular v9 -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-analytics.js";
        import { getDatabase, ref, push, onValue, get, update } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

        // Using your existing Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCrSS4lsxgSFA7SEtseW1KoiruQbUwR_xA",
            authDomain: "aipex-6d63b.firebaseapp.com",
            databaseURL: "https://aipex-6d63b-default-rtdb.europe-west1.firebasedatabase.app/",
            projectId: "aipex-6d63b",
            storageBucket: "aipex-6d63b.appspot.com",
            messagingSenderId: "356818143159",
            appId: "1:356818143159:web:49222b5a85629c4630ca32",
            measurementId: "G-D32Z47WHQ4"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getDatabase();

        document.addEventListener('DOMContentLoaded', function () {
            // Real-time database listener for models
            onValue(ref(db, 'models/'), (snapshot) => {
                try {
                    const modelsList = document.getElementById('modelsList');
                    modelsList.innerHTML = '';

                    if (!snapshot.exists()) {
                        modelsList.innerHTML = '<p>No models available yet.</p>';
                        return;
                    }

                    // Convert to array and group models by category
                    const models = [];
                    snapshot.forEach((childSnapshot) => {
                        models.push({
                            id: childSnapshot.key,
                            ...childSnapshot.val()
                        });
                    });

                    const groupedModels = models.reduce((acc, model) => {
                        if (!acc[model.category]) acc[model.category] = [];
                        acc[model.category].push(model);
                        return acc;
                    }, {});

                    // Display top ten models for each category
                    Object.keys(groupedModels).forEach(category => {
                        const categoryModels = groupedModels[category];
                        categoryModels.sort((a, b) => b.votes - a.votes);

                        const categoryElement = document.createElement('div');
                        categoryElement.className = 'category-section';
                        categoryElement.innerHTML = `<h2>Top 10 in ${category}</h2>`;
                        
                        const topTenModels = categoryModels.slice(0, 10);
                        topTenModels.forEach(model => {
                            const modelElement = document.createElement('div');
                            modelElement.className = 'model-card';
                            modelElement.innerHTML = `
                                <div class="model-info">
                                    <h3>${model.name}</h3>
                                    <span class="license">License: ${model.license}</span>
                                    <span class="votes">Votes: ${model.votes}</span>
                                    <span class="timestamp">Added: ${new Date(model.createdAt).toLocaleDateString()}</span>
                                </div>
                            `;
                            categoryElement.appendChild(modelElement);
                        });

                        modelsList.appendChild(categoryElement);
                    });
                } catch (error) {
                    console.error('Failed to load models:', error);
                    alert('Failed to load model rankings. Please try again later.');
                }
            });
        });
    </script>
</head>

<body>
    <header>
        <h1>Aipex Rankings - Top AI Models</h1>
    </header>
    <main>
        <section id="ranking">
            <div id="modelsList" class="models-grid">
                <!-- Top 10 models by category will appear here -->
            </div>
        </section>
        <footer>
            <a href="admin.html">Admin Page</a>
        </footer>
    </main>
</body>

</html>
